extends layout/mainFrame
block append css
  link(rel="stylesheet",href="css/jquery.simplyscroll.css",media="all",type="text/css")
  link(href='css/shop_home.css', rel='stylesheet', media='screen')

block append content
  .container(style='padding: 10px 0;')
    .row
        .span2
          ul.nav.nav-pills.nav-stacked(style='width: 150px;')
            li.text-center.active
              a.text-left(onclick='', href='#car_manager', data-toggle='pill') 销售销售库存管理
            li.text-center
              a.text-left(href='#car_order', data-toggle='pill') 预约订单管理
            li.text-center
              a.text-left(href='#shop_info', data-toggle='pill') 信息维护
            li.text-center
              a.text-left(href='#change_psw', data-toggle='pill') 修改密码
        .span10.tab-content
          #car_manager.tab-pane.active
            legend 销售库存管理
            input.btn.btn-primary.pull-right.span2(type='button', onclick="window.location.href='/stockeditor'", value='新建')
            table.table.stockTable
              thead
                tr
                  th  型号
                  th  外观颜色
                  th  内饰颜色
                  th  价格
                  th  库存(现货/在途)
                  th  备注
                  th  操作
              tbody
                each item in shopStockView
                  tr#shopStockTr(style='cursor: pointer;', onclick="focusTr(this,'tr#{item.id}')")
                    td  #{item.carModelLv3FullName}
                    td  #{item.carOutsideColorName}
                    td  #{item.carInsideColorName}
                    td  #{item.carPrice}万
                    td  #{item.carOnHandeNum} / #{item.carOnOrderNum}
                    td  #{item.carAddition}
                    td
                      a(href="#") 修改
                  tr.shopStockTr(id="tr#{item.id}",style='display: none')
                    td(colspan='7')
                      table
                        tbody
                          tr.detail
                            td(style="color:#555555;font-weight: bold") 详细配置说明
                            td 真皮座椅
                            td 导航
                            td 天窗
                            td 定速巡航
                            td 倒车雷达
                            td 电动座椅
                            td 座椅加热
                            td 倒车影像
                            td 多功能方向盘
                      table
                        tbody
                          tr.detail
                            td 鼎强汽车酷夏促销进行中，凡购车即送万元装潢大礼包，可办理贷款，0首付低利率！

          #car_order.tab-pane
            legend 预约订单管理
            table.table
              thead
                tr
                  th 订单序号
                  th 订单名称
                  th 订单类型
                  th 订单日期
                  th 汽车金额
                  th 备注
              tbody
                tr
                  td 20130612A010201
                  td 预定大众速腾2012款 1.6L 手动时尚型 黄色
                  td 预约
                  td 2013.06.12
                  td 12.18万
                  td 无
                tr
                  td 20130612A087652
                  td 预定大众速腾2012款 1.6L 手动时尚型 黄色
                  td 预约
                  td 2013.06.12
                  td 12.18万
                  td 无
          #shop_info.tab-pane
            legend 信息维护
            form.form-horizontal#saveshopForm(method="post",action="/shop?type=saveshop",style="width:400px;")
              .control-group
                label.control-label(for='shopName') 4s店名
                .controls
                  input#shopName(name="shopName",type='text', value='#{shop.shopName}')
              .control-group
                label.control-label(for="shopCity")城市
                .controls
                  select(id="shopCity",name="shopCity")
                    option(value="") 选择城市
              .control-group
                label.control-label(for='shopTel') 电话
                .controls
                  input#shopTel(name="shopTel",type='text', value='#{shop.shopTel}')
              .control-group
                label.control-label(for='shopEmail') 邮箱
                .controls
                  input#shopEmail(name="shopEmail",type='text', value='#{shop.shopEmail}')
              .control-group
                label.control-label(for='shopAddress') 地址
                .controls
                  textarea#shopAddress(name="shopAddress",placeholder='地址', rows='3') #{shop.shopAddress}
              div.alert.alert-error.hide#save-error 修改失败
              div.alert.alert-success.hide#save-succee 修改成功
              .control-group
                .controls
                  a(href="#",class="btn btn-primary pull-right",onclick="saveshop()") 保存
          #change_psw.tab-pane
            legend 修改密码
            .span5
              form.form-horizontal
                .control-group
                  label.control-label(for='oldpsw') 原密码
                  .controls
                    input#oldpsw(type='text', placeholder='原密码')
                .control-group
                  label.control-label(for='newpsw') 新密码
                  .controls
                    input#newpsw(type='text', placeholder='新密码')
                .control-group
                  label.control-label(for='confnewpsw') 确认新密码
                  .controls
                    input#confnewpsw(type='text', placeholder='确认新密码')
                .control-group
                  .controls
                    button.btn.btn-primary.pull-right.span2 提交
  script.
    function saveshop(){
        $.post("/shop?type=saveshop", $("#saveshopForm").serialize())
        .done(function(data) {
             if(data.saveSuc){
                 $("#save-succee").show();
                 $("#save-error").hide();
             }
             else{
                 $("#save-succee").slideUp();
                 $("#save-error").slideDown();
             }
         });
     }


    $(document).ready(function(){
      $.getJSON("/dic?type=DicCity",function(data){
          $.each(data,function(i,e){
             $("#shopCity").append("<option value=" + e.id + ">" + e.cityCname +  "</option>");
          });
          $("#shopCity").val("#{shop.shopCity}");
      });
    });


    var currentFocusTr = "";
    function focusTr(elment,trId){
      if(currentFocusTr != ""){
        if(currentFocusTr != trId){
          $("#" + currentFocusTr).hide();
        }
        else{
          $("#" + trId).fadeOut(0);
        }
      }
      if(currentFocusTr != trId){
        $("#" + trId).fadeIn(0);
        currentFocusTr = trId;
      }
      else{
        currentFocusTr = "";
      }
    }